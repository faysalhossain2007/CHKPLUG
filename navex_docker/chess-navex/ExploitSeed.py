import os
import sys, getopt
from io import StringIO

"""
  Author: Abeer Alhuzali
"""

class ExploitSeed(object):


    def __init__(self, file ="", src="", dst="", params="", get=""):
        '''
        Constructor
        '''
        self.file= file
        self.src = src
        self.dst = dst
        self.params = params
        self.get=get
        



    def stripDataFromOutput(self, output):
        """
        Extract the exploit strings information from the exploit seeds output file .
        Example output :
        
        SRC_URL:
		DEST_URL:
		NameValuePair:
        
        """
        buf = StringIO.StringIO(output)
        
        file= buf.readline()
        

        # Extract src url.
        start_index = len("SRC_URL:")
        src= buf.readline()[start_index:]
        #print("the source is %s" % src)
        # Extract dest url from second line.
        start_index = len("DEST_URL: ")
        dst=[]
        tdst = buf.readline()[start_index:].strip().split(" ")
        for d in tdst:
        	index = d.find("?")
        
        	if index > -1:
        	   d=d[:index]
        	   
        	dst.append(d)



        # Extract params from third line.
        start_index = len("NameValuePair: ")
        params = buf.readline()[start_index:].split(",")

        # Extract params from third line.
        start_index = len("get: ")
        get = buf.readline()[start_index:].split(" ")
        
        self.src    = src.strip()
        self.dst   = dst
        self.params = params
        self.get= get 
        self.file = file;  

    def getGet(self):
        if self.get != "":
            return self.get
        
        else:
            raise Exception(
                    "get is wrong. Maybe "
                    "it was not set? get: %s" % (self.get))  


    def getSource(self):
        if self.src != "":
            return self.src
        
        else:
            raise Exception(
                    "source url is wrong. Maybe "
                    "it was not set? src: %s" % (self.src))


    def getDestination(self):
        if self.dst != "":
            return self.dst
        
        else:
            raise Exception(
                    "dst url is wrong. Maybe "
                    "it was not set? sdst: %s" % (self.dst))


    def getParams(self):
        if self.params != "":
            return self.params
        
        else:
            raise Exception(
                    "params are wrong. Maybe "
                    "it was not set? params: %s" % (self.params))  